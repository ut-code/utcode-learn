---
title: トランスパイラとモジュールバンドラ
---

import getStartedWithViteVideo from "./get-started-with-vite.mp4";
import buildVideo from "./build.mp4";
import fakerAppVideo from "./faker-app.mp4";
import canvasConfettiAppVideo from "./canvas-confetti-app.mp4";

## 複雑化するWeb開発

JavaScriptは、当初はWebサイトに簡易的な動きを追加させるための言語として設計されました。しかしながら、高度なWebアプリケーションの台頭や、Node.jsをはじめとしたブラウザにおけるJavaScriptのユースケースの広がりにより、標準的なJavaScriptのみでの開発には限界があることがわかってきました。

このため、現代では、JavaScriptは事前に何らかの変換を行っておくことが一般的になっています。

### <Term>トランスパイラ</Term>

{/* prettier-ignore */}
<Term>**トランスパイラ**</Term>は、ソースコードを別のソースコードに変換するためのプログラムです。JavaScriptにおいてトランスパイラが必要になるのは、主に2つの理由によります。

ひとつは、**最新の機能を使用するため**です。JavaScriptの言語仕様は、[Ecma International](https://www.ecma-international.org/)の[TC39](https://tc39.es/)によって作成されていますが、新しく策定された仕様は、まだブラウザなどによって実装されていない場合があります。[Babel](https://babeljs.io/)は、そういった最新の言語仕様に沿って書かれたプログラムを変換し、古い仕様の範囲内で解釈できるプログラムに変換するための、最も有名な<Term>トランスパイラ</Term>です。

もうひとつは、**別の言語で書かれたプログラムをJavaScriptに変換するため**です。次の章で扱うTypeScriptは、トランスパイラを用いてJavaScriptに変換されます。

### <Term>モジュールバンドラ</Term>

通常、規模の大きなプログラムは、見通しが良くなるよう複数のファイルに分割されます。HTMLから複数のJavaScriptを読み込むためには`script`タグを並べれば良いですが、[HTTPサーバー](/docs/web-servers/server/)の節で学んだように、`script`タグの数だけ<Term>HTTPリクエスト</Term>が発行されてしまうため非効率的です。

[webpack](https://webpack.js.org)のような<Term>**モジュールバンドラ**</Term>を用いることで、複数のJavaScriptファイルを統合できます。

なお、Node.jsの場合は、モジュールの読み込みはファイルの読み込みに過ぎず、ネットワークを経由することはないため、このプロセスは通常必要ありません。

![JavaScriptファイルの変換](./javascript-conversion.drawio.svg)

## Viteを用いたフロントエンド開発

Web開発の領域では、ブラウザ (クライアント) で動くJavaScriptプログラムを**フロントエンド**、サーバーで動くプログラムを**バックエンド**と呼ぶことがあります。

[Vite](https://vitejs.dev/)は、主にフロントエンドの領域における、<Term>トランスパイラ</Term>や<Term>モジュールバンドラ</Term>などの機能を持つソフトウェアです。

Viteを用いて新しくプロジェクトを作成してみましょう。

<video src={getStartedWithViteVideo} controls />

詳細な手順は次のとおりです。

まずは、ターミナルでカレントディレクトリをプロジェクトフォルダを格納するディレクトリに移動し、

```shell
npm create vite@latest
```

を実行します。`Select a framework`と尋ねられるので、`Vanilla`を選択してください。その後、`Select a variant`と尋ねられるので、`JavaScript`を選択してください。

すると、`package.json`を含む新しいディレクトリがカレントディレクトリに作成されます。このディレクトリをVS Codeで開きましょう。

続いて、作成された`package.json`をもとにnpmから必要なパッケージをダウンロードするため、

```shell
npm install
```

を実行します。完了したら、

```shell
npm run dev
```

を実行してください。

Vite内蔵のウェブサーバーが起動し、`http://localhost:5173/`でウェブサイトが表示されます。

## Viteの仕組み

Viteの挙動を理解するため、<kbd>Ctrl</kbd> + <kbd>C</kbd> (Windows) / <kbd>control</kbd> + <kbd>C</kbd> (macOS) で先ほど起動させたウェブサーバーを停止させ、`npm run build`コマンドを実行してみましょう。

```shell
$ npm run build

> vite@0.0.0 build
> vite build

vite v7.1.7 building for production...
✓ 7 modules transformed.
dist/index.html                 0.45 kB │ gzip: 0.29 kB
dist/assets/index-CrYBktwj.css  1.20 kB │ gzip: 0.62 kB
dist/assets/index-_AYE_jbl.js   2.58 kB │ gzip: 1.40 kB
✓ built in 130ms
```

これにより、カレントディレクトリに`dist`ディレクトリが作成され、<Term>トランスパイル</Term>と<Term id="module-bundler">バンドル</Term>の結果が格納されます。

出力されたファイルを元のファイルと比較してみましょう。元の`index.html`や`main.js`が、変換された状態で出力されていることがわかります。ディレクトリごと[Netlify Drop](/docs/trial-session/deploy-application/)などにアップロードすれば使用可能になるでしょう。

このように、<Term>トランスパイル</Term>や<Term id="module-bundler">バンドル</Term>などにより必要な変換や最適化を施し、実行可能な形式の最終成果物を生成する一連の処理は一般に<Term>**ビルド**</Term>と呼ばれます。本番環境では、これにより生成された最終成果物を配布します。

<video src={buildVideo} controls />

:::tip[`npm run`コマンド]

`npm run`コマンドは、`package.json`の`scripts`プロパティに記載されたコマンドを実行します。開発によく使うコマンドを登録しておくことで、コマンドを打つ手間を削減できます。

`npm create vite@latest`が自動的に生成する`package.json`の`scripts`プロパティは、次のようになっていました。ここに記載されたコマンドでは、`npx`コマンドを用いたときのように、npmでインストールされたパッケージをそのまま実行できます。例えば、`npm run dev`コマンドを実行することで、`npx vite`に相当する処理が行われます。

```json title="package.json (一部抜粋)"
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  }
}
```

:::

## npmのパッケージをWebブラウザ上で利用する

npmのパッケージがブラウザ上での実行に対応している場合は、Viteをはじめとした<Term>トランスパイラ</Term>や<Term>モジュールバンドラ</Term>により、ブラウザ向けのJavaScriptに変換させられます。例として`date-fns`パッケージを使用してみましょう。

```javascript
import { format } from "date-fns";

document.getElementById("app").textContent = format(
  new Date("2022-01-10"),
  "yyyy年MM月dd日",
);
```

<ViewSource url={import.meta.url} path="_samples/run-npm-package-on-browsers" />

## 演習問題1

[Faker](https://fakerjs.dev/)は、ランダムな名前や住所などのデータを生成するためのパッケージです。Fakerをインストールして、次のようにランダムな名前を生成して画面に表示してみましょう。

<video src={fakerAppVideo} controls />

<Answer title="Faker">

Viteを用いて新しいプロジェクトを作成し、`npm install @faker-js/faker`コマンドでFakerをインストールします。続いて、`main.js`を次のように書き換えます。

[`faker.person.fullName`関数](https://fakerjs.dev/api/person.html#fullname)を用いると、ランダムな氏名を生成できます。

```javascript title="main.js"
import { faker } from "@faker-js/faker";

document.getElementById("app").textContent = faker.person.fullName();
```

<ViewSource url={import.meta.url} path="_samples/faker" />

</Answer>

## 演習問題2

[`canvas-confetti`パッケージ](https://github.com/catdad/canvas-confetti)は、Webブラウザ上で紙吹雪を降らせるためのパッケージです。`canvas-confetti`パッケージをインストールして、次のように画面に紙吹雪を降らせてみましょう。

<video src={canvasConfettiAppVideo} controls />

<Answer title="canvas-confetti">

Viteを用いて新しいプロジェクトを作成し、`npm install canvas-confetti`コマンドで`canvas-confetti`パッケージをインストールします。続いて、`main.js`を次のように書き換えます。

```javascript title="main.js"
import confetti from "canvas-confetti";

confetti();
```

<ViewSource url={import.meta.url} path="_samples/canvas-confetti" />

</Answer>
