---
title: プロジェクト
---

import todoVideo from "./todo.mp4";

ここまでの知識を使って、シンプルな ToDo アプリを作ってみましょう。

## ルール

- ToDo の追加ができます。
- ToDo の削除ができます。
- ToDo の編集ができます。
- 入力欄が空欄だと ToDo の追加ができなくなります。

<video src={todoVideo} controls loop autoPlay muted />

## ヒント

いきなり作るのが難しい場合はタスクを分解してみましょう。今回はルールにもあるように

1. ToDo を追加できるようにする
2. ToDo を削除できるようにする
3. ToDo を編集できるようにする
4. 空の ToDo を追加できないようにする

の4つの仕事があるので、まず 1 からやっていきましょう。

## ステップ 1: ToDo を追加する

ひとまず ToDo の一覧、ToDo の入力欄、ToDo の追加ボタンが必要です。
`ul` 要素と `input` 要素と `button` 要素を使ってみましょう。

```html title=index.html
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Title</title>
  </head>
  <body>
    <ul id="todo-list"></ul>
    <input id="todo-input" />
    <button id="add-button">追加</button>
    <script src="./script.js"></script>
  </body>
</html>
```

次に JavaScript ファイルを作成して追加ボタンを押したときの処理を記述しましょう。

```javascript title=script.js
const todoList = document.getElementById("todo-list");
const todoInput = document.getElementById("todo-input");
const addButton = document.getElementById("add-button");

addButton.onclick = () => {
  // 追加ボタンを押すと todo を 1 つ追加する
};
```

この時リストの項目として新たに `li` 要素を追加する必要があります。
[`document.createElement` 関数](https://developer.mozilla.org/ja/docs/Web/API/Document/createElement) を使うと新しい要素を作成できます。また、[`Node#appendChild` メソッド](https://developer.mozilla.org/ja/docs/Web/API/Node/appendChild) を用いることで既存の要素内に子要素を追加することができます。

```javascript
const li = document.createElement("li");
todoList.appendChild(li);
```

また、`HTMLInputElement#value` プロパティから入力欄への入力内容を取得できます。

<Details summary='ステップ 1 の解答例'>

```html title=index.html
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Title</title>
  </head>
  <body>
    <ul id="todo-list"></ul>
    <input id="todo-input" />
    <button id="add-button">追加</button>
    <script src="./script.js"></script>
  </body>
</html>
```

```javascript title=script.js
const addButton = document.getElementById("add-button");
const todoList = document.getElementById("todo-list");
const todoInput = document.getElementById("todo-input");

addButton.onclick = () => {
  const inputValue = todoInput.value;
  todoInput.value = "";
  const todoItem = document.createElement("li");
  const todoText = document.createElement("span");
  todoText.textContent = inputValue;
  todoItem.appendChild(todoText);
  todoList.appendChild(todoItem);
};
```

<ViewSource url={import.meta.url} path="_samples/step1" />

</Details>

## ステップ 2: ToDo を削除する

次に削除ボタンを追加します。
[`document.createElement` 関数](https://developer.mozilla.org/ja/docs/Web/API/Document/createElement) で `button` 要素を生成し削除ボタンにしてから [`Node#appendChild` メソッド](https://developer.mozilla.org/ja/docs/Web/API/Node/appendChild) で要素内に追加しましょう。

削除ボタンを押すと `li` 要素が 1 つ消える機能を実装するためには、ある要素から子要素を取り除く [`Node#removeChild` メソッド](https://developer.mozilla.org/ja/docs/Web/API/Node/removeChild) を使います。

```javascript
// todoList から todoItem を取り除く
todoList.removeChild(todoItem);
```

<Details summary='ステップ 2 の解答例'>

```html title=index.html
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Title</title>
  </head>
  <body>
    <ul id="todo-list"></ul>
    <input id="todo-input" />
    <button id="add-button">追加</button>
    <script src="./script.js"></script>
  </body>
</html>
```

```javascript title=script.js
const addButton = document.getElementById("add-button");
const todoList = document.getElementById("todo-list");
const todoInput = document.getElementById("todo-input");

addButton.onclick = () => {
  const inputValue = todoInput.value;
  todoInput.value = "";
  const todoItem = document.createElement("li");
  const todoText = document.createElement("span");
  const deleteButton = document.createElement("button");
  todoText.textContent = inputValue;
  deleteButton.textContent = "削除";
  deleteButton.onclick = () => {
    todoList.removeChild(todoItem);
  };
  todoItem.appendChild(todoText);
  todoItem.appendChild(deleteButton);
  todoList.appendChild(todoItem);
};
```

<ViewSource url={import.meta.url} path="_samples/step2" />

</Details>

## ステップ 3: ToDo を編集する

編集ボタンをつけてみましょう。

編集ボタンを押されたときに ToDo のテキストを入力欄に、編集ボタンを確定ボタンに入れ替えます。
[`Node#replaceChild` メソッド](https://developer.mozilla.org/ja/docs/Web/API/Node/replaceChild) を使い、ある要素の子要素を別の要素にいれかえることができます。

```javascript
const confirmButton = document.createElement("button");
confirmButton.textContent = "確定";
// 編集ボタンを確定ボタンに入れ替え
todoItem.replaceChild(confirmButton, editButton);
```

<Details summary='ステップ 3 の解答例'>

```html title=index.html
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Title</title>
  </head>
  <body>
    <ul id="todo-list"></ul>
    <input id="todo-input" />
    <button id="add-button">追加</button>
    <script src="./script.js"></script>
  </body>
</html>
```

```javascript title=script.js
const todoList = document.getElementById("todo-list");
const todoInput = document.getElementById("todo-input");
const addButton = document.getElementById("add-button");

addButton.onclick = () => {
  const inputValue = todoInput.value;
  todoInput.value = "";
  const todoItem = document.createElement("li");
  const todoText = document.createElement("span");
  const editButton = document.createElement("button");
  const deleteButton = document.createElement("button");
  todoText.textContent = inputValue;
  editButton.textContent = "編集";
  editButton.onclick = () => {
    const input = document.createElement("input");
    const confirmButton = document.createElement("button");
    input.value = todoText.textContent;
    confirmButton.textContent = "確定";
    confirmButton.onclick = () => {
      todoText.textContent = input.value;
      todoItem.replaceChild(todoText, input);
      todoItem.replaceChild(editButton, confirmButton);
    };
    todoItem.replaceChild(input, todoText);
    todoItem.replaceChild(confirmButton, editButton);
  };
  deleteButton.textContent = "削除";
  deleteButton.onclick = () => {
    todoList.removeChild(todoItem);
  };
  todoItem.appendChild(todoText);
  todoItem.appendChild(editButton);
  todoItem.appendChild(deleteButton);
  todoList.appendChild(todoItem);
};
```

<ViewSource url={import.meta.url} path="_samples/step3" />

</Details>

## ステップ 4: 空の ToDo を入れさせない

[`HTMLButtonElement#disabled` プロパティ](https://developer.mozilla.org/ja/docs/Web/API/HTMLButtonElement/disabled) が `true` の時、ボタンはクリックを受け付けなくなります。
入力欄が空の時にこのプロパティを `true` に、それ以外の時は `false` にすることによって空のタスクの追加を防ぐことができます。
この時、入力欄に何かキー入力があるたびに入力欄が空かどうかを判定する必要があります。
[`HTMLElement#oninput` プロパティ](https://html.spec.whatwg.org/multipage/webappapis.html#handler-oninput) にイベントハンドラを登録すると、ユーザーによって要素に入力されたときに実行される関数を定めることができます。

```javascript
todoInput.oninput = () => {
  // 入力欄が空の時はボタンを押せないようにする
  addButton.disabled = todoInput.value === "";
};
```

## 解答

<Answer>

```html title=index.html
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Title</title>
  </head>
  <body>
    <ul id="todo-list"></ul>
    <input id="todo-input" />
    <button id="add-button" disabled>追加</button>
    <script src="./script.js"></script>
  </body>
</html>
```

```javascript title=script.js
const todoList = document.getElementById("todo-list");
const todoInput = document.getElementById("todo-input");
const addButton = document.getElementById("add-button");
todoInput.oninput = () => {
  addButton.disabled = todoInput.value === "";
};

addButton.onclick = () => {
  const inputValue = todoInput.value;
  todoInput.value = "";
  addButton.disabled = true;
  const todoItem = document.createElement("li");
  const todoText = document.createElement("span");
  const editButton = document.createElement("button");
  const deleteButton = document.createElement("button");
  todoText.textContent = inputValue;
  editButton.textContent = "編集";
  editButton.onclick = () => {
    const input = document.createElement("input");
    const confirmButton = document.createElement("button");
    input.value = todoText.textContent;
    input.oninput = () => {
      confirmButton.disabled = input.value === "";
    };
    confirmButton.textContent = "確定";
    confirmButton.onclick = () => {
      todoText.textContent = input.value;
      todoItem.replaceChild(todoText, input);
      todoItem.replaceChild(editButton, confirmButton);
    };
    todoItem.replaceChild(input, todoText);
    todoItem.replaceChild(confirmButton, editButton);
  };
  deleteButton.textContent = "削除";
  deleteButton.onclick = () => {
    todoList.removeChild(todoItem);
  };
  todoItem.appendChild(todoText);
  todoItem.appendChild(editButton);
  todoItem.appendChild(deleteButton);
  todoList.appendChild(todoItem);
};
```

<ViewSource url={import.meta.url} path="_samples/todo" />

</Answer>

## 追加ステップ: 読みやすいコード

上の解答例でおしまいでもいいのですが、今後のメンテナンスをしやすいように<Term>モジュール化</Term>などをほどこして読みやすいコードにしてみましょう。

まずは、クラスにまとめてみましょう。

<Answer title="クラスにまとめる">

```js
const todoList = document.getElementById("todo-list");
const todoInput = document.getElementById("todo-input");
const addButton = document.getElementById("add-button");

todoInput.oninput = () => {
  addButton.disabled = todoInput.value === "";
};
addButton.onclick = () => {
  const todoItem = new Todo(todoInput.value);
  todoInput.value = "";
  addButton.disabled = true;
  todoList.appendChild(todoItem);
};

class Todo {
  todoItem;
  todotext;
  input;
  editButton;
  confrimButton;
  deleteButton;
  constructor(text) {
    this.todoItem = document.createElement("li");
    this.todoText = document.createElement("span");
    this.editButton = document.createElement("button");
    this.deleteButton = document.createElement("button");

    this.todoText.textContent = text;
    this.editButton.textContent = "編集";
    this.deleteButton.textContent = "削除";

    this.editButton.onclick = () => this.startEdit();
    this.deleteButton.onclick = () => this.deleteSelf();

    this.todoItem.appendChild(todoText);
    this.todoItem.appendChild(editButton);
    this.todoItem.appendChild(deleteButton);
  }

  startEdit() {
    this.input = document.createElement("input");
    this.confirmButton = document.createElement("button");
    this.input.value = todoText.textContent;
    this.confirmButton.textContent = "確定";
    this.confirmButton.onclick = () => this.endEdit();
    this.input.oninput = () => this.validate();
    this.todoItem.replaceChild(this.input, this.todoText);
    this.todoItem.replaceChild(this.confirmButton, this.editButton);
  }
  endEdit() {
    this.todoText.textContent = input.value;
    this.todoItem.replaceChild(this.todoText, this.input);
    this.todoItem.replaceChild(this.editButton, this.confirmButton);
  }
  deleteSelf() {
    todoList.removeChild(this.todoItem);
  }
  validateConfirmButton() {
    this.confirmButton.disabled = this.input.value === "";
  }
}
```

</Answer>

読みやすくなったことで、`startEdit` 関数が `endEdit` 関数より明らかに操作が多いことに気づきました。
一部毎回実行する必要のないコードがまぎれているので、それをコンストラクタに移動しましょう。

<Answer title="余計なコードの移動">

```js
const todoList = document.getElementById("todo-list");
const todoInput = document.getElementById("todo-input");
const addButton = document.getElementById("add-button");

todoInput.oninput = () => {
  addButton.disabled = todoInput.value === "";
};
addButton.onclick = () => {
  const todoItem = new Todo(todoInput.value);
  todoInput.value = "";
  addButton.disabled = true;
  todoList.appendChild(todoItem);
};

class Todo {
  todoItem;
  todotext;
  input;
  editButton;
  confrimButton;
  deleteButton;
  constructor(text) {
    this.todoItem = document.createElement("li");
    this.todoText = document.createElement("span");
    this.input = document.createElement("input");
    this.editButton = document.createElement("button");
    this.confirmButton = document.createElement("button");
    this.deleteButton = document.createElement("button");

    this.todoText.textContent = text;
    this.editButton.textContent = "編集";
    this.confirmButton.textContent = "確定";
    this.deleteButton.textContent = "削除";

    this.input.oninput = () => this.validate();
    this.editButton.onclick = () => this.startEdit();
    this.confirmButton.onclick = () => this.endEdit();
    this.deleteButton.onclick = this.deleteSelf();

    this.todoItem.appendChild(this.todoText);
    this.todoItem.appendChild(editButton);
    this.todoItem.appendChild(deleteButton);
  }

  startEdit() {
    this.input.value = this.todoText.textContent;
    this.todoItem.replaceChild(this.input, this.todoText);
    this.todoItem.replaceChild(this.confirmButton, this.editButton);
  }
  endEdit() {
    this.todoText.textContent = input.value;
    this.todoItem.replaceChild(this.todoText, this.input);
    this.todoItem.replaceChild(this.editButton, this.confirmButton);
  }
  deleteSelf() {
    todoList.removeChild(this.todoItem);
  }
  validateConfirmButton() {
    this.confirmButton.disabled = this.input.value === "";
  }
}
```

</Answer>
