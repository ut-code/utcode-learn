---
title: プロジェクト
---

import todoVideo from "./todo.mp4";

ここまでの知識を使って、シンプルな ToDo アプリを作ってみましょう。

## ルール

- ToDo の追加ができます。
- ToDo の削除ができます。
- ToDo の編集ができます。
- 入力欄が空欄だと ToDo の追加ができなくなります。

<video src={todoVideo} controls loop autoPlay muted />

## ヒント

いきなり作るのが難しい場合はタスクを分解してみましょう。今回はルールにある4つの課題をひとつずつ解決していきます。

1. ToDo を追加できるようにする。
2. ToDo を削除できるようにする。
3. ToDo を編集できるようにする。
4. 空の ToDo を追加できないようにする。

の4つの仕事があるので、まず 1 からやっていきましょう。

### ステップ 1: ToDo を追加する

ひとまず ToDo の一覧、ToDo の入力欄、ToDo の追加ボタンが必要です。
`ul` 要素と `input` 要素と `button` 要素を使ってみましょう。

```html title=index.html
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Title</title>
  </head>
  <body>
    <ul id="todo-list"></ul>
    <input id="todo-input" />
    <button id="add-button">追加</button>
    <script src="./script.js"></script>
  </body>
</html>
```

次に JavaScript ファイルを作成して追加ボタンを押したときの処理を記述しましょう。

```javascript title=script.js
const todoList = document.getElementById("todo-list");
const todoInput = document.getElementById("todo-input");
const addButton = document.getElementById("add-button");

addButton.onclick = () => {
  // 追加ボタンを押すと ToDo を 1 つ追加する
};
```

この時箇条書きの項目として新たに `li` 要素を追加する必要があります。
DOM の章で扱ったように、[`document.createElement` 関数](https://developer.mozilla.org/ja/docs/Web/API/Document/createElement) を使うと新しい要素を作成できます。
また、[`Node#appendChild` メソッド](https://developer.mozilla.org/ja/docs/Web/API/Node/appendChild) を用いることで既存の要素内に子要素を追加することができます。

```javascript
const li = document.createElement("li");
todoList.appendChild(li);
```

また、`HTMLInputElement#value` プロパティから、DOM に対応する input 要素の入力欄への入力内容を取得できます。

```js
const todoText = document.createElement("span");
todoText.textContent = todoInput.value; // input 要素に入力された文字列を取得する
todoInput.value = ""; // input 要素の入力欄を空にする
```

<Details summary='ステップ 1 の解答例'>

```html title=index.html
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Title</title>
  </head>
  <body>
    <ul id="todo-list"></ul>
    <input id="todo-input" />
    <button id="add-button">追加</button>
    <script src="./script.js"></script>
  </body>
</html>
```

```javascript title=script.js
const todoList = document.getElementById("todo-list");
const todoInput = document.getElementById("todo-input");
const addButton = document.getElementById("add-button");

addButton.onclick = () => {
  const todoItem = document.createElement("li");
  const todoText = document.createElement("span");
  todoText.textContent = todoInput.value;
  todoInput.value = "";
  todoItem.appendChild(todoText);
  todoList.appendChild(todoItem);
};
```

<ViewSource url={import.meta.url} path="_samples/step1" />

</Details>

### ステップ 2: ToDo を削除する

次に削除ボタンを追加します。
[`document.createElement` 関数](https://developer.mozilla.org/ja/docs/Web/API/Document/createElement) で `button` 要素を生成し削除ボタンにしてから [`Node#appendChild` メソッド](https://developer.mozilla.org/ja/docs/Web/API/Node/appendChild) で要素内に追加しましょう。

削除ボタンを押すと `li` 要素が 1 つ消える機能を実装するためには、ある要素から子要素を取り除く [`Node#removeChild` メソッド](https://developer.mozilla.org/ja/docs/Web/API/Node/removeChild) を使います。

```javascript
// todoList から todoItem を取り除く
todoList.removeChild(todoItem);
```

<Details summary='ステップ 2 の解答例'>

```html title=index.html
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Title</title>
  </head>
  <body>
    <ul id="todo-list"></ul>
    <input id="todo-input" />
    <button id="add-button">追加</button>
    <script src="./script.js"></script>
  </body>
</html>
```

```javascript title=script.js
const todoList = document.getElementById("todo-list");
const todoInput = document.getElementById("todo-input");
const addButton = document.getElementById("add-button");

addButton.onclick = () => {
  const todoItem = document.createElement("li");
  const todoText = document.createElement("span");
  const deleteButton = document.createElement("button");
  todoText.textContent = todoInput.value;
  todoInput.value = "";
  deleteButton.textContent = "削除";
  deleteButton.onclick = () => {
    todoList.removeChild(todoItem);
  };
  todoItem.appendChild(todoText);
  todoItem.appendChild(deleteButton);
  todoList.appendChild(todoItem);
};
```

<ViewSource url={import.meta.url} path="_samples/step2" />

</Details>

### ステップ 3: ToDo を編集する

編集ボタンをつけてみましょう。

編集ボタンが押されたときに、ユーザーにテキストを入力するように促すダイアログを表示します。
[`prompt` 関数](https://developer.mozilla.org/ja/docs/Web/API/Window/prompt を使い、ユーザーに入力を求めることができます。

```javascript
// ユーザーに入力を求め、入力された値を todoText.textContent に代入する
todoText.textContent = prompt("新しい内容を入力してください。");
```

<Details summary='ステップ 3 の解答例'>

```html title=index.html
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Title</title>
  </head>
  <body>
    <ul id="todo-list"></ul>
    <input id="todo-input" />
    <button id="add-button">追加</button>
    <script src="./script.js"></script>
  </body>
</html>
```

```javascript title=script.js
const todoList = document.getElementById("todo-list");
const todoInput = document.getElementById("todo-input");
const addButton = document.getElementById("add-button");

addButton.onclick = () => {
  const todoItem = document.createElement("li");
  const todoText = document.createElement("span");
  const editButton = document.createElement("button");
  const deleteButton = document.createElement("button");
  todoText.textContent = todoInput.value;
  todoInput.value = "";
  editButton.textContent = "編集";
  editButton.onclick = () => {
    todoText.textContent = prompt("編集内容を入力してください");
  };
  deleteButton.textContent = "削除";
  deleteButton.onclick = () => {
    todoList.removeChild(todoItem);
  };
  todoItem.appendChild(todoText);
  todoItem.appendChild(editButton);
  todoItem.appendChild(deleteButton);
  todoList.appendChild(todoItem);
};
```

<ViewSource url={import.meta.url} path="_samples/step3" />

</Details>

### ステップ 4: 空の ToDo を入れさせない

[`HTMLButtonElement#disabled` プロパティ](https://developer.mozilla.org/ja/docs/Web/API/HTMLButtonElement/disabled) が `true` の時、ボタンはクリックを受け付けなくなります。
入力欄が空の時にこのプロパティを `true` に、それ以外の時は `false` にすることによって空のタスクの追加を防ぐことができます。
この時、入力欄に何かキー入力があるたびに入力欄が空かどうかを判定する必要があります。
[`HTMLElement#oninput` プロパティ](https://html.spec.whatwg.org/multipage/webappapis.html#handler-oninput) にイベントハンドラを登録すると、ユーザーによって要素に入力されたときに実行される関数を定めることができます。

```javascript
todoInput.oninput = () => {
  // 入力欄が空の時はボタンを押せないようにする
  addButton.disabled = todoInput.value === "";
};
```

## 解答

<Answer>

```html title=index.html
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Title</title>
  </head>
  <body>
    <ul id="todo-list"></ul>
    <input id="todo-input" />
    <button id="add-button" disabled>追加</button>
    <script src="./script.js"></script>
  </body>
</html>
```

```javascript title=script.js
const todoList = document.getElementById("todo-list");
const todoInput = document.getElementById("todo-input");
const addButton = document.getElementById("add-button");

todoInput.oninput = () => {
  addButton.disabled = todoInput.value === "";
};

addButton.onclick = () => {
  const todoItem = document.createElement("li");
  const todoText = document.createElement("span");
  const editButton = document.createElement("button");
  const deleteButton = document.createElement("button");
  todoText.textContent = todoInput.value;
  todoInput.value = "";
  editButton.textContent = "編集";
  editButton.onclick = () => {
    const input = prompt("編集内容を入力してください");
    // prompt 関数は入力された文字列が空の場合は空文字列 ("")、キャンセルされた場合は null を返す
    if (input !== "" && input !== null) todoText.textContent = input;
  };
  deleteButton.textContent = "削除";
  deleteButton.onclick = () => {
    todoList.removeChild(todoItem);
  };
  todoItem.appendChild(todoText);
  todoItem.appendChild(editButton);
  todoItem.appendChild(deleteButton);
  todoList.appendChild(todoItem);
};
```

<ViewSource url={import.meta.url} path="_samples/todo" />

</Answer>

## 発展

- ToDo を、`prompt` 関数を使わずにその場で編集できるようにしてみましょう。

:::tip

ToDo 一つに対する操作が多くなってきたので、クラスを定義してあげると分かりやすくなるかもしれません。

:::

{/* TODO: INSERT IN-PLACE EDITING VIDEO HERE */}

<Answer title="その場で編集">

```js title="script.js"
class TodoItem {
  text;

  li;
  span;
  input;
  editButton;
  confirmButton;
  deleteButton;

  constructor(text) {
    this.text = text;
    this.li = document.createElement("li");
    this.span = document.createElement("span");
    this.input = document.createElement("input");
    this.editButton = document.createElement("button");
    this.confirmButton = document.createElement("button");
    this.deleteButton = document.createElement("button");

    this.span.textContent = text;
    this.input.value = text;
    this.editButton.textContent = "編集";
    this.confirmButton.textContent = "完了";
    this.deleteButton.textContent = "削除";

    this.editButton.onclick = () => this.startEdit();
    this.confirmButton.onclick = () => this.endEdit();
    this.deleteButton.onclick = () => this.deleteSelf();

    this.input.oninput = () => this.validateConfirmButton();

    this.li.appendChild(this.span);
    this.li.appendChild(this.editButton);
    this.li.appendChild(this.deleteButton);
  }

  startEdit() {
    this.li.removeChild(this.span);
    this.li.removeChild(this.editButton);
    this.li.removeChild(this.deleteButton);
    this.li.appendChild(this.input);
    this.li.appendChild(this.confirmButton);
    this.input.value = this.text;
  }
  endEdit() {
    this.text = this.input.value;
    this.li.removeChild(this.input);
    this.li.removeChild(this.confirmButton);
    this.li.appendChild(this.span);
    this.li.appendChild(this.editButton);
    this.li.appendChild(this.deleteButton);
    this.span.textContent = this.text;
  }
  deleteSelf() {
    todoList.removeChild(this.li);
  }
  validateConfirmButton() {
    this.confirmButton.disabled = this.input.value === "";
  }
}

const todoList = document.getElementById("todo-list");
const todoInput = document.getElementById("todo-input");
const addButton = document.getElementById("add-button");

todoInput.oninput = () => (addButton.disabled = todoInput.value === "");

addButton.onclick = () => {
  const todoItem = new TodoItem(todoInput.value);
  todoList.appendChild(todoItem.li);
  todoInput.value = "";
};
```

</Answer>

- (任意) 以下の機能を自分で調べて実装してみましょう。

5. ToDo の前後に空白が入れられていた場合、それを消す
6. エンターキー・エスケープキーで編集を終了できるようにする
7. 編集ボタンを押したら自動的に input 要素にフォーカスされるようにする
8. 複数の ToDo を同時に編集できないようにする

<Answer>

5 は `String#trim` メソッド、6 は `EventTarget#addEventListener` メソッド、7 は `HTMLElement#focus` メソッドを用います。
8 は今回は、グローバル変数に編集中の `todoItem` を保存する変数を作ることで実装します。

```js title="script.js"
class TodoItem {
  text;

  li;
  span;
  input;
  editButton;
  confirmButton;
  deleteButton;

  constructor(text) {
    this.text = text;
    this.li = document.createElement("li");
    this.span = document.createElement("span");
    this.input = document.createElement("input");
    this.editButton = document.createElement("button");
    this.confirmButton = document.createElement("button");
    this.deleteButton = document.createElement("button");

    this.span.textContent = text;
    this.input.value = text;
    this.editButton.textContent = "編集";
    this.confirmButton.textContent = "完了";
    this.deleteButton.textContent = "削除";

    this.editButton.onclick = () => this.startEdit();
    this.confirmButton.onclick = () => this.endEdit();
    this.deleteButton.onclick = () => this.deleteSelf();

    this.input.oninput = () => this.validateConfirmButton();

    // 6.
    this.input.addEventListener("keydown", (event) => {
      if (event.key === "Enter" || event.key === "Escape") this.endEdit();
    });
    this.li.appendChild(this.span);
    this.li.appendChild(this.editButton);
    this.li.appendChild(this.deleteButton);
  }

  startEdit() {
    // 8.
    if (editingTodo !== null) editingTodo.endEdit();
    this.li.removeChild(this.span);
    this.li.removeChild(this.editButton);
    this.li.removeChild(this.deleteButton);
    this.li.appendChild(this.input);
    this.li.appendChild(this.confirmButton);
    this.input.value = this.text;

    // 8.
    editingTodo = this;

    // 7.
    this.input.focus();
  }
  endEdit() {
    // 8.
    editingTodo = null;

    // 5.
    this.text = this.input.value.trim();

    // 5、6
    if (this.text === "") {
      this.deleteSelf(); // confirmButton が disabled でも Enter/Escape キーで入力できる
      return;
    }
    this.li.removeChild(this.input);
    this.li.removeChild(this.confirmButton);
    this.li.appendChild(this.span);
    this.li.appendChild(this.editButton);
    this.li.appendChild(this.deleteButton);
    this.span.textContent = this.text;
  }
  deleteSelf() {
    todoList.removeChild(this.li);
  }
  validateConfirmButton() {
    // 5.
    this.confirmButton.disabled = this.input.value.trim() === "";
  }
}

const todoList = document.getElementById("todo-list");
const todoInput = document.getElementById("todo-input");
const addButton = document.getElementById("add-button");

// 8.
let editingTodo = null;

todoInput.oninput = () => (addButton.disabled = todoInput.value === "");

// 6.
todoInput.addEventListener("keydown", (event) => {
  if (event.key === "Enter") {
    addButton.click();
  }
});
addButton.onclick = () => {
  // 5、6
  if (todoInput.value.trim() === "") return; // addButton が disabled でも Enter キーで入力できる

  // 5.
  const todoItem = new TodoItem(todoInput.value.trim());
  todoList.appendChild(todoItem.li);
  todoInput.value = "";
};
```

</Answer>
